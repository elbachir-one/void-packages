# Template file for 'openvswitch'
pkgname=openvswitch
version=3.4.1
revision=1
archs="i686* x86_64* ppc64*"
build_style=gnu-configure
configure_args="--with-rundir=/run/openvswitch"
pycompile_dirs="usr/share/openvswitch/python"
hostmakedepends="pkg-config python3"
makedepends="openssl-devel libcap-ng-devel"
depends="python3"
checkdepends="iproute2"
short_desc="Production quality, multilayer virtual switch"
maintainer="Orphaned <orphan@voidlinux.org>"
license="Apache-2.0"
homepage="https://openvswitch.org/"
distfiles="https://www.openvswitch.org/releases/${pkgname}-${version}.tar.gz"
checksum=6e97ec7dfdda5b40b5103946d53e4f8b11edf66049fedbdcb323e1af67133de8
python_version=3
_completiondir="/usr/share/bash-completion/completions"
make_install_args+=" completiondir=${_completiondir}"
# test can hang in containers
make_check=extended

post_install() {
	for cmd in ovs-appctl ovs-vsctl; do
		chmod 0644 ${DESTDIR}${_completiondir}/$cmd-bashcomp.bash
		mv ${DESTDIR}${_completiondir}/$cmd-bashcomp.bash \
		   ${DESTDIR}${_completiondir}/$cmd
	done
	for cmd in ovs-ofctl ovs-dpctl ovsdb-tool; do
		ln -s ovs-appctl ${DESTDIR}${_completiondir}/$cmd
	done
	vsv ovsdb-server
	vsv ovs-vswitchd
}

openvswitch-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove usr/lib/*.a
	}
}
